# Excel でなぞる遺伝子発現解析

普通はプログラミングかR言語でするような遺伝子発現解析を、Excelで試しに（できる部分だけ）やってみようという試み

## GEOからの遺伝子発現データの取得
- GEO (Gene Expression Omnibus) は、NCBIが集めている遺伝子発現のデータベース
  - もともとはマイクロアレイのデータベースだったがNGS（次世代シーケンサー）が出てきてRNA-Seqのデータもここに入ることになり、今は遺伝子発現データのデータベースとなっている。
  - てなわけで今はNGSデータの方がはやりなのだが、NGSデータの解析自体で1回の講義になってしまうレベルし、コマンドラインや計算機リソースを駆使するような計算なので、今回はある程度そのあたりを計算済ということでマイクロアレイのデータを例とする。
- あらためまして、GEOのサイトにアクセスするのだが、今回は混乱を避けるために測定データセットを検索するサイトを示しておく。 https://www.ncbi.nlm.nih.gov/gds/
- 生物種名や生命現象を検索ボックスに入れて、どのようなデータがあるか楽しんでみましょう
  - 詳細まで見るといくつかのパターンがあることがわかります
    - 正常と疾患/変異株/薬剤処理など状態を2群間で比較するデータ
    - ある状態下でのさまざまな臓器など多サンプル間で比較するデータ
    - 薬剤処理後の時間経過ごと、発生ステージなどなどの時系列データ
- 今回は、GSE15515 ：Transcriptome Profiles of Differentiated arabidopsis Leaf Cells and Dedifferentiating Protoplasts of Ler and kyp mutant （シロイヌナズナ Ler および kyp 変異体における分化した葉細胞と脱分化したプロトプラストでのトランスクリプトーム [全遺伝子発現] プロファイル）を用いることとします。 https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE15515
- Samples の項目を見ると、どういうサンプル（試料・材料）を使って実験をしたかが書いてあります
  - 上の比較データか、時系列データか意識して、どれがセットか考えるといいでしょう
  - 場合によっては同じようなデータを何回もとっているものがあります。
    - 同じサンプルを何回か測定：technical replica。複数やることで実験操作を相殺する
    - 別個体で何回か測定：biological replica。複数やることで個体差を相殺する
- その下のところに実際の遺伝子発現データがダウンロードできる形で置いてあるが、単純な表にはなっていないので加工が必要（実験情報がくっついているので、そのままではExcelで開けない）
  - SOFT formatted family file(s)
  - Series Matrix File(s)
- 今回はこのデータをもとに講義用に加工したデータ([GSE15515.for_lecture.txt](data/GSE15515.for_lecture.txt))を使って説明する。（のでダウンロードしておく）

## 遺伝子発現データの統計的な解析
### ファイルを開く
- Excelを立ち上げる
- 今回はテキストファイル（Windowsでいうところのメモ帳で開くファイル。Excel形式でないもの）なので ファイル > 開く でなく、ファイル > インポート
- 今回はタブ区切り（tsv: tab separated value）なので、テキストファイルとして読み込む。
- 読み込みのダイアログが出る。区切り記号付き → 区切り文字 タブ などと選びながら次へを押していく
  - 各列のデータタイプで遺伝子名が書かれた列は標準でなく文字列を選ぶとOct4問題は回避できる
- 無事に開ける
- 今回はID_REF（プローブ名）, leaf1, leaf2, protoplast1, protoplast2 というデータ構成になっている。
- 2万行近くあるので、画面の分割をすると楽である。
  - どこか適当なセルを選択して 表示 > 分割
  - 線をドラッグすると分割場所を動かせる。端まで持って行くと分割解除
  - 下半分のウインドウのどこかのセルを選択し、スクロールバーをドラッグして末尾へ。
- **[ファイルの保存]** 何はともあれファイルの保存。ファイル > 名前をつけて保存 で Excelブックとして保存
  - 普通に（テキストファイルとして）保存してしまうと、関数やグラフが保存されない

### データの分布を調べてみる
- データの列には遺伝子の発現量が数値で入っている
  - GEOに登録してあるのは対数値なのですが、Excelで対数をとる演習のために今回はわざわざ数値を元に戻しています
- ちらちら眺めると0に近い値から数千まで数値があるような
- そこで、各列の一番下の行で最大値と最小値を計算してみましょう
  - 一番下のデータの次の行あたりでセルを選択して
  - 最大値を例に：`=max(`まで入力すると、範囲を聞かれるので、上ウインドウでB2（一番上）をクリックし、Shiftを押しながら下ウインドウでB22811をクリック。Enterを押すと`)`が勝手に補完されて計算される。
  - 同様に最小値 `=min(...)`も
- 続けて、中央値（median）と平均値も計算してみる
- 1列分計算できたので、計算結果を複数セル選択し、右下をドラッグして数式をコピーする
- 結果が出る
![最大値、最小値、中央値、平均値の結果](./images/excel_function.png)
- 考察：左2列がleaf、右2列がprotoplast。これからその2列どうしの数値の平均をとるが、特に中央値や平均値が大きくずれていないので、2列のデータの分布はほぼ同じそうだと期待でき、特に補正（正規化という）をせずに先に進むこととする。（というか実際はすでに補正済のデータが登録されていたのだろう）

### 2つの状態での発現量を比較する
- 左2列のleaf、右2列のprotoplastをそれぞれ2回実験をしたとみなして、誤差を補正するために平均をとることとする。
- E列（protoplastの左側の列）のどこかのセルをクリックしてからD列とE列の間に空の列を挿入する（ホーム >挿入の∨記号（かそれに類するもの）> シートの列を挿入）
- 一番上に ave(leaf) なり適当にラベルを振っておく
- とりあえず一番上のデータでleafの2データの平均をとる
  - `=average(` とうって、B2セルをクリック。その後、コンマを入力してC2を選択するか、shift+C2をクリックか、でEnter
- 全データで平均値をとる。今 計算したセル（D2）を選択してコピー。ペーストしたいセルとしてまずはD3をクリック。shiftキーを押しながら下ウインドウのD22811をクリックしてペースト。計算結果が出ればOK
- 同様にprotoplastも各データの平均値を計算する

### この先
- 対数とる
- 発現差（発現比）を計算する
- グラフで可視化して見てみる
- フィルター機能でX倍ののみ抽出
- IDをコピー
- DAVIDでエンリッチメント解析。生物学的機能の解釈をする
