---
title: "learningR"
author: "Nakazato T."
date: "2020/6/23"
output:
  word_document: default
  html_document: default
  pdf_document: default
---

これは、R Markdownというしくみを利用した文章です。

文章中にRのコードを埋め込んで、なおかつ実行でき、しかもあとでレポートとして出力できるというスグレモノです。
コード部分などは自分で書き換えられるので、いろいろ試してみましょう。

一番簡単なのはとりあえず計算することですね
```{r}
1+1
```

上のグレーの背景になっているところがRのコードです。
本当は下の欄のConsoleで実行させるのですが、右上の▶︎をクリックすることでこの窓で実行できます。
計算結果の2が表示されます。
（[1] の部分は訊かれた1番目の答えという意味です）

次は代入です。代入には <- の記号を使います。
```{r}
x <- 1
```

▶︎をクリックすると、右側の欄に代入結果が表示されます。
クリック前と後で変化することを確認しましょう。

呼び出すときは変数をそのまま書けばよいです。
```{r}
x
```

次も代入で、y に何かを代入するのですが、せっかくなので3の部分を自分で適当な数字を書き換えて実行させてみましょう。

```{r}
y <- 3
```


次は計算です。普通に数式を書けばよいです。

```{r}
x+y
```

実行させてみましょう。

計算結果を代入して表示させることもできます。
```{r}
z <- x*y
z
```

代入には文字も入れられます
```{r}
a <- "Hello World!"
```
" " で囲うことに注意しましょう。
文字列どうしの足し算などはあたりまえながらできないのですが、データに対して、代入した変数のラベルをつけるというような使い方をします。



次にグラフを描いてみましょうか。

```{r}
x1 <- rnorm(1000, 0, 1)
plot(x1, type="l", col="blue")
```

右上の▶︎をクリックしてみましょう。
グラフが表示されましたか。

今回、x1 <- rnorm(1000, 0, 1) のところで
1000個の0を平均、1を標準偏差とする乱数を発生させています。（標準偏差って何? って感じでしょうが、気にしなくていいです）
このグラフは、1番目から1000番目まで、発生した数字をとりあえず折れ線グラフにしたものです。（x1を折れ線（type="l"） で色を青でグラフにする（plot））

今回、▶ をクリックするたびに乱数の発生をやり直すので、上で ▶ を何度かクリックしてグラフが書き換わるのを確認しましょう。

参考までに、右の欄で発生した数値の中身が見られます。

せっかくなので別のグラフを。
今、x1として発生させた乱数がどんな分布になっているかヒストグラムを描いてみます。
```{r}
hist(x1)
```

もう少し細かい分布にしたり色をつけたりすることもできます

```{r}
hist(x1, breaks = 60, col ="#ff00ff40")
```

今、このウインドウの中でグラフが表示されてしまっていますが、下のコンソールで実行させれば（↑ キーで以前のコマンドに戻れます）、右下のウインドウにグラフが表示され、グラフ直上のExportから、グラフをファイルに保存させることもできます。

だいたい雰囲気が掴めたところで、このウインドウの直上にあるInsertからRを選ぶとRのコマンドを挿入することができますから、ネット上にあるいろいろなコマンドをコピーして自分でいろいろ実行させてみましょう。

そして、Knitというボタンを押すと、（結果付きで）レポートファイルを作成することもできます!（Wordでも! 設定をきちんとすればPDFでも!）

Rはコマンドもとっつきにくいですし、実際のデータをもっていないと使う機会もないですが、ネット上にいろいろリソースも転がっているので、必要な時にマネしてつっついてみてください。



統計処理の例として、Rにデモ用データとしてあらかじめ入っているirisのデータを眺めてみます。
（チュートリアルムービーサイト統合TVでも解説があります。 http://togotv.dbcls.jp/20180408.html ）

Rでは、より専門的なことを行うための外部パッケージを導入することができます。
今回は可視化（＝さまざまなグラフ描画）を行うggplot2を導入してみます。
```{r eval=FALSE, include=FALSE}
install.packages("ggplot2")
```

インストールしたパッケージを用いるときは呼び出しを行う必要があります。
（インストールは自分のマシンにダウンロードして使えるよう状態にすること。加えてここでは実際に使うためにこのドキュメントから呼び出しを行う）
```{r include=FALSE}
library("ggplot2")
```



データの中身を確認します。
```{r}
head(iris)
```

いわずもがなですが、irisはアヤメのことです。
  - Sepal：がく片
  - Petal：花びら
  - Species：種名

たとえば、個々のがく片の長さの分布を見るには以下のようにします。
  - hist(データ名$列名)

```{r}
hist(iris$Sepal.Length)
```

そして、この場合、3種のデータそれぞれのがく片の長さの分布の比較は以下のようにします。
  - qplot(X軸, Y軸, data=データ名, geom="グラフの種類")
```{r}
qplot(Species, Sepal.Length, data=iris, geom="boxplot")
```

ここではqplotを使っていますが、別にいちいち関数名を覚える必要はナシ。
誰かがよさげなのを使っていたら拝借するだけです（今回は統合TVで使っているからコピペしただけ）。今後、こういうグラフが描きたいなーという場合は、ググって見つけるか、以前に書いたものを発掘して使い回すかです。
コピペするにあたって、引数（カッコの中身）の書き方がよくわからないかと思いますが、RStudioの右下部分の表示としてHelpタブがあるので、そこで（テキストボックスが2つありますが右上の虫眼鏡マークのついている方で）関数名を入れると解説が出てきます。（```help(topic = qplot)```のようにRStudio左下部分のConsoleでhelpを使ってもよいです）

同様に花びらの幅についてもグラフを描いて確認してみましょう。
（上の部分をコピペして）
```{r}
qplot(Species, Petal.Width, data=iris, geom="boxplot")
```

統合TVでは、I. setosaとI. versicolorの花びらの幅に統計的な差があるか確認しています。
（統計的な差：差があるのは偶然に起きる範囲か、確率を計算する）

まず花びらの幅のデータを見てみます。
```{r}
iris$Petal.Width
```

150個のデータがあるのですが、1〜50番目がI. setosa、51〜100番目がI. versicolorになっています。
実際の「統計的な有意差があるか」は、t検定という専門的な方法があり、t.test関数を使います。
```{r}
t.test(iris$Petal.Width[1:50], iris$Petal.Width[51:100])
```

「統計的有意差」はp-valueの値を見ます。単純には偶然に事象（この場合、幅が違うこと）が起きる確率だと思ってください。今回は、かなーり値が小さいので 幅が偶然に違う確率は小さい＝幅が違うことには意味がある（有意である）と結論づけられます。

